# Название задачи:
Архитектура MVP по передаче актуальных ставок по депозитам в свой и партнёрский кол-центр

# Автор:
Москвин Антон Игоревич

# Дата:
06.08.2025

---

## Функциональные требования

| № | Действующие лица или системы | Use Case | Описание |
| :-: | :- | :- | :- |
| 1 | Менеджер депозитов | Обновление ставок | Вносит актуальные ставки в централизованную систему (Rate Engine). |
| 2 | Rate Engine | Хранение ставок | Централизованно хранит все ставки по депозитам. |
| 3 | Система кол-центра | Получение ставок через API | Регулярно запрашивает ставки из Rate Engine для отображения оператору. |
| 4 | Оператор кол-центра | Консультация клиента | Использует актуальные ставки из интерфейса для ответа клиенту. |
| 5 | Rate Engine | Экспорт ставок в файл | Формирует CSV-файл с актуальными ставками и выкладывает на SFTP. |
| 6 | Партнёрский кол-центр | Получение файла со ставками | Регулярно забирает CSV-файл по SFTP. |
| 7 | Сотрудник партнёрского кол-центра | Консультация клиента | Использует данные из файла для ответа клиенту. |

---

## Нефункциональные требования

| № | Требование |
| :-: | :- |
| 1 | Ставки должны обновляться ежедневно. |
| 2 | Данные должны передаваться партнёрскому кол-центру в виде файла (SFTP). |
| 3 | Система кол-центра должна получать ставки через API. |
| 4 | Доступ к ставкам должен быть только у авторизованных систем. |
| 5 | Формат файла должен быть простым (CSV). |
| 6 | Процесс передачи ставок должен быть полностью автоматизирован. |
| 7 | Rate Engine должен использовать MS SQL или Oracle (уже есть в банке). |
| 8 | Решение должно быть совместимо с Java (экспертиза в команде АБС). |
| 9 | Rate Engine должен быть доступен 24/7 с уровнем доступности 99.9%. |

---

## Решение

### Диаграммы

Для визуализации архитектуры использована **C4 Model**:
- **Context Diagram** — показывает взаимодействие с внешними системами
- **Component Diagram** — детализирует компоненты Rate Engine

> Диаграммы прилагаются отдельно:
> - `C4_Context_Ставки.puml` — диаграмма контекста
> - `C4_Component_Ставки.puml` — диаграмма компонентов

### Описание решения

#### Основные компоненты

| Компонент | Описание |
|---------|--------|
| **Rate Engine** | Централизованная система хранения ставок. Реализован на Java Spring Boot + MS SQL. Единственный источник правды. |
| **API для ставок** | REST API, предоставляет ставки системе кол-центра. Аутентификация — по API Key. |
| **SFTP-экспорт** | Планировщик (cron) формирует CSV-файл и выкладывает на SFTP-сервер. |
| **SFTP-сервер** | Внутренний сервер банка, доступный для партнёрского кол-центра по защищённому каналу. |
| **Система кол-центра** | Получает ставки через API и отображает в интерфейсе оператора. |
| **Партнёрский кол-центр** | Получает файл со ставками и использует его для консультаций. |

#### Логика принятия решений

1. **Rate Engine** — уже используется для MVP по депозитам. Его можно расширить для хранения ставок.
2. **API для своего кол-центра** — позволяет быстро получать ставки в реальном времени.
3. **SFTP для партнёра** — единственная возможная интеграция. Файл — простой и надёжный способ.
4. **Формат CSV** — универсальный, легко читается, не требует специальных инструментов.
5. **Автоматизация** — ставки обновляются ежедневно, файл формируется автоматически.
6. **Технологии** — Java и MS SQL, потому что у команды АБС есть экспертиза.

#### Технологии

| Компонент | Технология | Обоснование |
|----------|-----------|-----------|
| Rate Engine | Java Spring Boot, MS SQL | Есть экспертиза в команде АБС |
| API | REST, HTTPS | Стандартная интеграция |
| SFTP | OpenSSH, cron | Просто, надёжно, безопасно |
| Формат файла | CSV | Универсальный, легко обрабатывается |

---

## Альтернативы

| Альтернатива | Обоснование отказа |
|-------------|-------------------|
| Передача ставок по email | Небезопасно, не подлежит аудиту, риск утечки |
| Хранение ставок в Excel на общем диске | Не масштабируется, нет контроля доступа |
| Реализация через АБС | АБС перегружен, плохо подходит для внешних интеграций |
| Использование Kafka для передачи ставок | Избыточно для партнёра, у которого нет API |
| JSON-файл вместо CSV | Партнёр может не уметь обрабатывать JSON |

---

## Недостатки, ограничения, риски

| Недостаток / Риск | Описание | Митигация |
|------------------|---------|---------|
| Ставки в файле могут устареть | Если партнёр не забирает файл | Установить SLA: файл обновляется ежедневно в 9:00 |
| Ошибки при ручной обработке файла | Партнёр может ошибиться | Добавить контрольную сумму в файл |
| SFTP может быть недоступен | Проблемы с сетью | Настроить мониторинг и оповещения |
| Rate Engine зависит от ручного ввода | Менеджер депозитов вводит ставки | Постепенно автоматизировать расчёт на основе данных из АБС |
| Кол-центр может быть перегружен | Рост числа звонков из-за маркетинга | Подключить партнёрский кол-центр для распределения нагрузки |