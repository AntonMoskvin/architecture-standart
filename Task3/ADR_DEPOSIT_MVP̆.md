# Название задачи:
Архитектура MVP по открытию депозитов онлайн в интернет-банке

# Автор:
Москвин Антон Игоревич

# Дата:
06.08.2025

---

## Функциональные требования

Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:

| № | Действующие лица или системы | Use Case | Описание |
| :-: | :- | :- | :- |
| 1 | Клиент | Просмотр депозитов | Клиент заходит в интернет-банк и видит список доступных депозитов с актуальными ставками. |
| 2 | Клиент, Система расчёта ставок | Получение персонализированной ставки | Система рассчитывает ставку на основе профиля клиента (объём средств, история). |
| 3 | Клиент | Подача заявки на депозит | Клиент выбирает счёт, сумму и подаёт заявку. |
| 4 | Система аутентификации | Подтверждение операции | Клиент подтверждает операцию СМС-кодом. |
| 5 | Интернет-банк | Отправка заявки в очередь | Заявка помещается в очередь (Kafka) для асинхронной обработки. |
| 6 | Служба обработки заявок | Передача заявки в АБС | Служба извлекает заявку из очереди и передаёт в АБС через API. |
| 7 | Менеджер бэк-офиса | Подтверждение заявки в АБС | На этапе MVP менеджер вручную подтверждает заявку в АБС. |
| 8 | АБС | Открытие депозита | АБС создаёт депозит, фиксирует ставку и сумму. |
| 9 | АБС → СМС-шлюз | Уведомление клиента | Клиент получает СМС о подтверждении ставки и открытии депозита. |

---

## Нефункциональные требования

Опишите здесь нефункциональные требования и архитектурно значимые требования.

| № | Требование |
| :-: | :- |
| 1 | АБС не должен напрямую обрабатывать запросы от интернет-банка из-за перегрузки. |
| 2 | Система должна быть доступна 24/7 с уровнем доступности 99.9%. |
| 3 | При сбое в ЦОД интернет-банк должен переключаться на резервный ЦОД. |
| 4 | Все данные должны передаваться по защищённым каналам (HTTPS/TLS). |
| 5 | Отклик на операции в интернет-банке — не более 1 секунды. |
| 6 | Решение должно использовать технологии, уже имеющиеся в банке (MS SQL, Oracle, .NET, Java). |
| 7 | Новые компоненты должны поддерживать горизонтальное масштабирование. |
| 8 | Избегать доработок ядра интернет-банка подрядчиком. |
| 9 | Предпочтительно использовать Kafka для асинхронной интеграции. |
| 10 | Ставки по депозитам должны рассчитываться вне АБС (Rate Engine). |

---

## Решение

### Диаграммы

Для визуализации архитектуры использована **C4 Model**:
- **Context Diagram** — показывает систему в контексте участников и внешних систем.
- **Container Diagram** — детализирует интернет-банк и АБС, показывает основные контейнеры и интеграции.

> Диаграммы прилагаются отдельно:
> - `C4_Context_Diagram.puml` — диаграмма контекста
> - `C4_Container_Diagram.puml` — диаграмма контейнеров

### Описание решения

#### Основные компоненты

| Компонент | Описание |
|---------|--------|
| **Интернет-банк** | Существующая система на ASP.NET MVC. Добавляется модуль подачи заявки на депозит. Не изменяется ядро. |
| **Rate Engine** | Новый микросервис на Java Spring Boot. Рассчитывает ставки на основе профиля клиента и данных из АБС. Хранит ставки в MS SQL. |
| **Kafka** | Брокер сообщений для асинхронной передачи заявок. Защищает АБС от прямых вызовов. |
| **Служба обработки заявок** | Сервис на .NET (для совместимости с интернет-банком), который читает заявки из Kafka и передаёт в АБС. |
| **АБС** | Основная система учёта. Получает заявки через API. Поддерживает ручное подтверждение на этапе MVP. |
| **СМС-шлюз** | Существующий шлюз для уведомлений. Интегрируется с АБС. |

#### Логика принятия решений

1. **Rate Engine вынесен отдельно**, чтобы не перегружать АБС и обеспечить гибкость.
2. **Kafka используется как буфер**, чтобы избежать прямого подключения интернет-банка к АБС.
3. **Ядро интернет-банка не меняется** — функционал реализуется как внешний модуль, интегрированный с ядром.
4. **Горизонтальное масштабирование** — интернет-банк и новые сервисы разворачиваются в кластере с балансировкой.
5. **Failover между ЦОД** — реализуется на уровне DNS и балансировщиков.
6. **Команда АБС может участвовать в разработке** — у них есть экспертиза по Java, поэтому Rate Engine разрабатывается силами банка.

#### Технологии

| Система | Технологии | Обоснование |
|--------|-----------|-----------|
| Rate Engine | Java Spring Boot, MS SQL | Есть экспертиза в команде АБС |
| Очереди | Kafka | Перспективная очередь, поддерживает масштабирование |
| Служба обработки | .NET 4.5, MS SQL | Совместимость с интернет-банком |
| API | REST, HTTPS | Стандартная интеграция |
| БД | MS SQL, Oracle | Уже используются в банке |

---

## Альтернативы

| Альтернатива | Обоснование отказа |
|-------------|-------------------|
| Прямое подключение интернет-банка к АБС | АБС перегружен. Прямое подключение может нарушить работоспособность банка. |
| Изменение ядра интернет-банка подрядчиком | Дорого, долго, зависит от подрядчика. Лучше избежать. |
| RabbitMQ вместо Kafka | Kafka — перспективный выбор для будущей цифровой трансформации. |
| Хранение ставок в Excel | Небезопасно, не подлежит аудиту, не масштабируется. |
| Реализация Rate Engine на .NET | Команда АБС сильнее в Java. Лучше использовать их экспертизу. |

---

## Недостатки, ограничения, риски

| Недостаток / Риск | Описание | Митигация |
|------------------|---------|---------|
| MVP требует участия бэк-офиса | Не полностью автоматизировано | Это временное решение. В финальном состоянии бэк-офис не нужен. |
| Kafka несовместим с текущей версией интернет-банка | Может потребоваться адаптация | Использовать адаптер или временно RabbitMQ |
| АБС масштабируется только вертикально | Узкое место | Ограничить нагрузку через очередь и кэширование |
| Резервный ЦОД не используется автоматически | Нет failover | Реализовать на уровне DNS и балансировщиков |
| Ставки зависят от ручных процессов | Пока в Excel | Rate Engine заменит Excel в MVP |
| Команда интернет-банка мала (10 человек) | Риск перегрузки | Привлечь специалистов из команды АБС |
| Подрядчик контролирует ядро интернет-банка | Ограничивает гибкость | Минимизировать изменения ядра |